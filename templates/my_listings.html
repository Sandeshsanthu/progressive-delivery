<!-- Code Generated by Sidekick is for learning and experimentation purposes only. -->
{% extends "base.html" %}
{% block content %}
  <div class="card">
    <h2>My listings</h2>
    <p class="muted">Only you can edit, delete, or mark your listings as sold.</p>
    <a class="btn primary" href="{{ url_for('new_listing') }}">Post a car</a>
  </div>

  {% for l in listings %}
    <div class="card">
      <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0 0 6px 0;">
            <a href="{{ url_for('listing_detail', listing_id=l['id']) }}">{{ l["title"] }}</a>
          </h3>
          <div class="muted">{{ l["year"] }} {{ l["make"] }} {{ l["model"] }} • {{ "{:,}".format(l["mileage"]) }} miles • {{ l["location"] }}</div>
          <div class="muted">Updated: {{ l["updated_at"] }}</div>
        </div>

        <div style="text-align:right; min-width:260px;">
          <div style="font-weight:bold;">{{ l["price_cents"] | money }}</div>
          {% if l["status"] == "ACTIVE" %}
            <div class="badge active">ACTIVE</div>
          {% else %}
            <div class="badge sold">SOLD</div>
          {% endif %}
          <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;">
            <a class="btn" href="{{ url_for('edit_listing', listing_id=l['id']) }}">Edit</a>

            {% if l["status"] == "ACTIVE" %}
              <form method="post" action="{{ url_for('mark_sold', listing_id=l['id']) }}">
                <button class="btn" type="submit">Mark sold</button>
              </form>
            {% endif %}

            <form method="post" action="{{ url_for('delete_listing', listing_id=l['id']) }}" onsubmit="return confirm('Delete this listing?');">
              <button class="btn danger" type="submit">Delete</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="card">You have no listings yet.</div>
  {% endfor %}
{% endblock %}

